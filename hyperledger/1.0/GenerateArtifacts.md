## [WIP]Usage of `cryptogen` and `configtxgen`

As we already put the `orderer.genesis.block` and `channel.tx` under `e2e_cli/channel-artifacts/`.

This step explains the creation of `orderer.genesis.block` (needed by orderer to bootup), `channel.tx` (needed by cli to create new channel) and crypto related configuration files.

### cryptogen

This tool will generate the x509 certificates used to identify and authenticate the various components in the network.

First boot MVE through `docker-compose-new-channel.yml`
```bash
$ docker-compose -f docker-compose-new-channel.yml up
```

This tool will generate dir `crypto-config`
```bash
cryptogen generate --config=./peer/crypto-config.yaml
```

### [configtxgen](http://hyperledger-fabric.readthedocs.io/en/latest/configtxgen.html?highlight=crypto#)

This tool will generate genesis block, channel configuration transaction and anchor peer update transactions.

Enter container `fabric-cli` first.
```
$ docker exec -it fabric-cli bash
```

The `configtxgen` tool is in `/go/bin/`, and when it's executed, 
it will read profile `/etc/hyperledger/fabric/configtx.yaml`, 
for example if we want to regenerate `orderer.genesis.block` and `channel.tx`, we should
replace `configtx.yaml` using our own configtx.yaml first, but now we use e2e test's configtx.yaml.

```bash
cp ./peer/configtx.yaml /etc/hyperledger/fabric
```

#### Create the genesis block

Generate the genesis block.

```bash
root@cli:/go/src/github.com/hyperledger/fabric# configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/orderer.genesis.block
```
> Note: Before execute this command, we must reboot MVE with new crypto-config generated by cryptogen tool.
> more details refe to Example2

#### Create the configuration tx
Create channel configuration transaction for the to-be-created `testchain`.
```bash
root@cli:/go/src/github.com/hyperledger/fabric# configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./peer/channel-artifacts/channel.tx -channelID testchain
```
`channel.tx` is used for generating new channel `testchain`


### Example1: how to add or change channel

* 1 Regenerate `channel.tx`
* 2 Generating anchor peer for Org1MSP
```bash
$ configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./peer/channel-artifacts/Org1MSPanchors.tx -channelID testchain -asOrg Org1MSP
```

### Example2: how to Add an organization or peer

* 1 Modify configtx.yaml and crypto-cnfig.yaml
* 2 Generate new crypto-config 
* 3 Reboot MVE using new config
* 4 Create the genesis block
* 5 Create configuration tx
* 6 Generating anchor peer for each Org